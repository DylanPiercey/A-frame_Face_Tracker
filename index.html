<!DOCTYPE html>
<html>

<head>
  <title>My A-Frame Test</title>
  <script src="//aframe.io/releases/0.7.0/aframe.min.js"></script>
  <script src="//unpkg.com/clmtrackr@latest/build/clmtrackr.min.js"></script>
  <!-- <script src="https://unpkg.com/aframe-forcegraph-component/dist/aframe-forcegraph-component.min.js"></script> -->
</head>

<body>
  <a-scene>
    <a-entity id="myCameraPosition" position="0 0 0">
      <a-entity id="myCamera" camera look-controls keyboard-controls>
      </a-entity>
    </a-entity>
    <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
    <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
    <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
    <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
    <a-sky color="#ECECEC"></a-sky>
  </a-scene>

  <script>
    navigator
      .mediaDevices
      .getUserMedia({ audio: false, video: { facingMode: 'user'} })
      .then(stream => {
        let pos;
        const camera = document.getElementById("myCameraPosition")
        const video = document.createElement('video')
        const tracker = new clm.tracker();
        video.srcObject = stream;
        video.onloadedmetadata = (e) => {
          video.width = video.videoWidth
          video.height = video.videoHeight
          video.play();
          tracker.init();
          tracker.start(video);
          updatePosition();
          window.tracker = tracker
        }
        
        function updatePosition () {
          const positions = tracker.getCurrentPosition();
          if (positions) {
            const first = positions[0]
            let minX = Infinity
            let maxX = -Infinity
            let minY = Infinity
            let maxY = -Infinity
            for (const [x, y] of positions) {
              if (x < minX) {
                minX = x
              } else if (x > maxX) {
                maxX = x
              }

              if (y < minY) {
                minY = y
              } else if (y > maxY) {
                maxY = y
              }
            }

            const avgX = minX + maxX / 2
            const avgY = minY + maxY / 2
            const area = (maxY - minY) * (maxX - minX)

            if (!pos) {
              pos =  { avgX, avgY, area }
            } else {
              const deltaX = pos.avgX - avgX
              const deltaY = pos.avgY - avgY
              const deltaZ = pos.area - area
              camera.setAttribute("position", `${deltaX * 0.01} ${deltaY * 0.01} ${deltaZ * 0.0001}`)
            }
          }
          requestAnimationFrame(updatePosition)
        }
      })
  </script>
</body>

</html>
